"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var index_1 = require("../api/index");
Page({
    data: {
        token: '',
        serial_number: '',
        phone: '',
        code: '',
        phone_model: '',
        list: [],
        array: [],
        list2: [],
        array2: [],
        multiArray: [[], []],
        multiIndex: [0, 0],
        index: 0,
        msgData: '获取验证码',
        time: 60,
        timer: 0,
        active: '',
        img: ''
    },
    onLoad: function () {
        var _this = this;
        wx.getStorage({
            key: 'token',
            success: function (res) {
                console.log(res);
                _this.setData({
                    token: res.data
                });
            }
        });
        this.getPhoneModels();
        this.getImg();
    },
    getImg: function () {
        var _this_1 = this;
        index_1.reqActivityShow(1).then(function (res) {
            if (res.code === 1) {
                _this_1.setData({
                    img: res.data
                });
            }
        });
    },
    bindMultiPickerChange: function (e) {
        console.log('picker发送选择改变，携带值为', e.detail.value);
        this.setData({
            multiIndex: e.detail.value
        });
        console.log(this.data.multiIndex);
    },
    bindMultiPickerColumnChange: function (e) {
        console.log('修改的列为', e.detail.column, '，值为', e.detail.value);
        if (e.detail.column === 0) {
            var _b = this.data, list = _b.list, array = _b.array;
            this.setData({
                multiArray: [array, list[e.detail.value]["subclass"].map(function (item) { return item.name; })]
            });
        }
    },
    input: function (e) {
        var _this_1 = this;
        var _b;
        console.log(e);
        var label = e.target.dataset.type;
        var value = e.detail.detail.value;
        console.log(value);
        this.setData((_b = {},
            _b[label] = value,
            _b), function () { return _this_1.doMerchantExist(); });
        console.log(label, value);
    },
    doMerchantExist: function () {
        if (this.data.serial_number.length < 5) {
            return;
        }
        index_1.reqMerchantExist(this.data.serial_number).then(function (res) {
            console.log(res);
            wx.showToast({
                icon: "none",
                title: res === 0 ? '商家编号不存在' : '商家存在'
            });
        });
    },
    getPhoneModels: function () {
        var _this_1 = this;
        index_1.reqPhoneModels().then(function (res) {
            if (res.code === 1) {
                console.log('get-phone-models', res);
                _this_1.setData({
                    list: res.data,
                    array: res.data.map(function (item) { return item.name; }),
                    list2: res.data[0].subclass,
                    array2: res.data[0].subclass.map(function (item) { return item.name; }),
                    multiArray: [res.data.map(function (item) { return item.name; }), res.data[0].subclass.map(function (item) { return item.name; })]
                });
            }
        });
    },
    changeCode: function (e) {
        console.log(e);
        this.setData({
            code: e.detail.value
        });
        console.log(this.data.code);
    },
    doSendMsg: function () {
        var _this = this;
        var _a = this.data, time = _a.time, timer = _a.timer;
        if (timer !== 0) {
            return;
        }
        var mobile = this.data.phone;
        var type = 'SMS_166320348';
        index_1.sendMsg({ type: type, mobile: mobile }).then(function (res) {
            if (res.code === 1) {
                timer = setInterval(function () {
                    if (time === 0) {
                        clearInterval(timer);
                        _this.setData({
                            timer: 0,
                            time: 60,
                            msgData: '获取验证码',
                            active: ''
                        });
                        return;
                    }
                    time--;
                    _this.setData({
                        msgData: time + 's',
                        timer: timer,
                        active: 'active'
                    });
                }, 1000);
            }
        });
    },
    getFreeFilm: function () {
        var _b = this.data, token = _b.token, serial_number = _b.serial_number, phone = _b.phone, code = _b.code, phone_model = _b.phone_model;
        console.log(phone_model);
        index_1.reqGetFreeFilm({ token: token, phone_model: phone_model, serial_number: serial_number, phone: phone, code: code }).then(function (res) {
            wx.showToast({
                title: res.message,
                icon: 'none',
                duration: 2000
            });
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnJlZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImZyZWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBd0c7QUFFeEcsSUFBSSxDQUFDO0lBRUosSUFBSSxFQUFFO1FBRUwsS0FBSyxFQUFFLEVBQUU7UUFDVCxhQUFhLEVBQUMsRUFBRTtRQUNoQixLQUFLLEVBQUMsRUFBRTtRQUNSLElBQUksRUFBQyxFQUFFO1FBQ1AsV0FBVyxFQUFDLEVBQUU7UUFFZCxJQUFJLEVBQUMsRUFBRTtRQUNQLEtBQUssRUFBRSxFQUFFO1FBQ1QsS0FBSyxFQUFFLEVBQUU7UUFDVCxNQUFNLEVBQUUsRUFBRTtRQUVWLFVBQVUsRUFBRSxDQUFDLEVBQUUsRUFBQyxFQUFFLENBQUM7UUFDbkIsVUFBVSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUVsQixLQUFLLEVBQUUsQ0FBQztRQUVSLE9BQU8sRUFBRSxPQUFPO1FBQ2hCLElBQUksRUFBRSxFQUFFO1FBQ1IsS0FBSyxFQUFFLENBQUM7UUFDUixNQUFNLEVBQUUsRUFBRTtRQUVWLEdBQUcsRUFBRSxFQUFFO0tBRVA7SUFFRCxNQUFNLEVBQU47UUFFQyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDakIsRUFBRSxDQUFDLFVBQVUsQ0FBQztZQUNiLEdBQUcsRUFBRSxPQUFPO1lBQ1osT0FBTyxFQUFQLFVBQVEsR0FBRztnQkFDVixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNqQixLQUFLLENBQUMsT0FBUSxDQUFDO29CQUNkLEtBQUssRUFBRSxHQUFHLENBQUMsSUFBSTtpQkFDZixDQUFDLENBQUE7WUFDSCxDQUFDO1NBQ0QsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQTtJQUNkLENBQUM7SUFFRCxNQUFNLEVBQU47UUFBQSxtQkFVQztRQVRBLHVCQUFlLENBQUMsQ0FBQyxD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QztRQUN6QixzQkFBYyxDQUFDLEVBQUMsS0FBSyxPQUFBLEVBQUMsV0FBVyxhQUFBLEVBQUMsYUFBYSxlQUFBLEVBQUMsS0FBSyxPQUFBLEVBQUMsSUFBSSxNQUFBLEVBQUMsQ0FBQyxDQUFDLElBQUksQ0FDaEUsVUFBQyxHQUFPO1lBQ1AsRUFBRSxDQUFDLFNBQVMsQ0FBQztnQkFDUCxLQUFLLEVBQUMsR0FBRyxDQUFDLE9BQU87Z0JBQ2pCLElBQUksRUFBQyxNQUFNO2dCQUNYLFFBQVEsRUFBQyxJQUFJO2FBQ2QsQ0FBQyxDQUFBO1FBQ1AsQ0FBQyxDQUNELENBQUE7SUFDRixDQUFDO0NBRUQsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtyZXFBY3Rpdml0eVNob3csIHJlcUdldEZyZWVGaWxtLCByZXFNZXJjaGFudEV4aXN0LCByZXFQaG9uZU1vZGVscywgc2VuZE1zZ30gZnJvbSBcIi4uL2FwaS9pbmRleFwiO1xuXG5QYWdlKHtcblxuXHRkYXRhOiB7XG5cblx0XHR0b2tlbjogJycsXG5cdFx0c2VyaWFsX251bWJlcjonJyxcblx0XHRwaG9uZTonJyxcblx0XHRjb2RlOicnLFxuXHRcdHBob25lX21vZGVsOicnLFxuXG5cdFx0bGlzdDpbXSxcblx0XHRhcnJheTogW10sXG5cdFx0bGlzdDI6IFtdLFxuXHRcdGFycmF5MjogW10sXG5cblx0XHRtdWx0aUFycmF5OiBbW10sW11dLFxuXHRcdG11bHRpSW5kZXg6IFswLCAwXSxcblxuXHRcdGluZGV4OiAwLFxuXG5cdFx0bXNnRGF0YTogJ+iOt+WPlumqjOivgeeggScsXG5cdFx0dGltZTogNjAsXG5cdFx0dGltZXI6IDAsXG5cdFx0YWN0aXZlOiAnJyxcblxuXHRcdGltZzogJydcblxuXHR9LFxuXG5cdG9uTG9hZCgpIHtcblx0XHQvLyDor7vlj5Z0b2tlblxuXHRcdGxldCBfdGhpcyA9IHRoaXM7XG5cdFx0d3guZ2V0U3RvcmFnZSh7XG5cdFx0XHRrZXk6ICd0b2tlbicsXG5cdFx0XHRzdWNjZXNzKHJlcykge1xuXHRcdFx0XHRjb25zb2xlLmxvZyhyZXMpO1xuXHRcdFx0XHRfdGhpcy5zZXREYXRhISh7XG5cdFx0XHRcdFx0dG9rZW46IHJlcy5kYXRhXG5cdFx0XHRcdH0pXG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHR0aGlzLmdldFBob25lTW9kZWxzKCk7XG5cdFx0dGhpcy5nZXRJbWcoKVxuXHR9LFxuXG5cdGdldEltZygpIHtcblx0XHRyZXFBY3Rpdml0eVNob3coMSkudGhlbihcblx0XHRcdChyZXM6IGFueSkgPT4ge1xuXHRcdFx0XHRpZiAocmVzLmNvZGUgPT09IDEpIHtcblx0XHRcdFx0XHR0aGlzLnNldERhdGEhKHtcblx0XHRcdFx0XHRcdGltZzogcmVzLmRhdGFcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KVxuXHR9LFxuXG5cdGJpbmRNdWx0aVBpY2tlckNoYW5nZTogZnVuY3Rpb24gKGU6IGFueSkge1xuXHRcdGNvbnNvbGUubG9nKCdwaWNrZXLlj5HpgIHpgInmi6nmlLnlj5jvvIzmkLrluKblgLzkuLonLCBlLmRldGFpbC52YWx1ZSk7XG5cdFx0dGhpcy5zZXREYXRhISh7XG5cdFx0XHRtdWx0aUluZGV4OiBlLmRldGFpbC52YWx1ZVxuXHRcdH0pXG5cdFx0Y29uc29sZS5sb2codGhpcy5kYXRhLm11bHRpSW5kZXgpO1xuXHR9LFxuXG5cdGJpbmRNdWx0aVBpY2tlckNvbHVtbkNoYW5nZTogZnVuY3Rpb24gKGU6IGFueSkge1xuXHRcdGNvbnNvbGUubG9nKCfkv67mlLnnmoTliJfkuLonLCBlLmRldGFpbC5jb2x1bW4sICfvvIzlgLzkuLonLCBlLmRldGFpbC52YWx1ZSk7XG5cdFx0aWYgKGUuZGV0YWlsLmNvbHVtbiA9PT0gMCkge1xuXHRcdFx0bGV0IHtsaXN0LCBhcnJheX0gPSB0aGlzLmRhdGE7XG5cdFx0XHR0aGlzLnNldERhdGEhKHtcblx0XHRcdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdFx0XHRtdWx0aUFycmF5OiBbYXJyYXksIGxpc3RbZS5kZXRhaWwudmFsdWVdW1wic3ViY2xhc3NcIl0ubWFwKGl0ZW0gPT4gaXRlbS5uYW1lKV1cblx0XHRcdH0pXG5cdFx0fVxuXHR9LFxuXG5cblx0aW5wdXQoZTogYW55KSB7XG5cdFx0Y29uc29sZS5sb2coZSk7XG5cdFx0Y29uc3QgbGFiZWwgPSBlLnRhcmdldC5kYXRhc2V0LnR5cGU7XG5cdFx0Y29uc3QgdmFsdWUgPSBlLmRldGFpbC5kZXRhaWwudmFsdWU7XG5cdFx0Y29uc29sZS5sb2codmFsdWUpO1xuXHRcdHRoaXMuc2V0RGF0YSEoe1xuXHRcdFx0W2xhYmVsXTogdmFsdWVcblx0XHR9LCAoKSA9PiB0aGlzLmRvTWVyY2hhbnRFeGlzdCgpKTtcblxuXHRcdGNvbnNvbGUubG9nKGxhYmVsLCB2YWx1ZSk7XG5cdH0sXG5cblx0ZG9NZXJjaGFudEV4aXN0KCkge1xuXHRcdGlmICh0aGlzLmRhdGEuc2VyaWFsX251bWJlci5sZW5ndGggPCA1KSB7XG5cdFx0XHRyZXR1cm5cblx0XHR9XG5cdFx0cmVxTWVyY2hhbnRFeGlzdCh0aGlzLmRhdGEuc2VyaWFsX251bWJlcikudGhlbihcblx0XHRcdChyZXM6IGFueSkgPT4ge1xuXHRcdFx0XHRjb25zb2xlLmxvZyhyZXMpO1xuXHRcdFx0XHR3eC5zaG93VG9hc3Qoe1xuXHRcdFx0XHRcdGljb246IFwibm9uZVwiLFxuXHRcdFx0XHRcdHRpdGxlOiByZXMgPT09IDAgPyAn5ZWG5a6257yW5Y+35LiN5a2Y5ZyoJyA6ICfllYblrrblrZjlnKgnXG5cdFx0XHRcdH0pXG5cdFx0XHR9XG5cdFx0KVxuXHR9LFxuXG5cdGdldFBob25lTW9kZWxzKCkge1xuXHRcdHJlcVBob25lTW9kZWxzKCkudGhlbihcblx0XHRcdHJlcyA9PiB7XG5cdFx0XHRcdGlmIChyZXMuY29kZSA9PT0gMSkge1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKCdnZXQtcGhvbmUtbW9kZWxzJywgcmVzKTtcblx0XHRcdFx0XHR0aGlzLnNldERhdGEhKHtcblx0XHRcdFx0XHRcdGxpc3Q6IHJlcy5kYXRhLFxuXHRcdFx0XHRcdFx0YXJyYXk6IHJlcy5kYXRhLm1hcCgoaXRlbTogYW55KSA9PiBpdGVtLm5hbWUpLFxuXHRcdFx0XHRcdFx0bGlzdDI6IHJlcy5kYXRhWzBdLnN1YmNsYXNzLFxuXHRcdFx0XHRcdFx0YXJyYXkyOiByZXMuZGF0YVswXS5zdWJjbGFzcy5tYXAoKGl0ZW06IGFueSkgPT4gaXRlbS5uYW1lKSxcblx0XHRcdFx0XHRcdG11bHRpQXJyYXk6IFtyZXMuZGF0YS5tYXAoKGl0ZW06IGFueSkgPT4gaXRlbS5uYW1lKSwgcmVzLmRhdGFbMF0uc3ViY2xhc3MubWFwKChpdGVtOiBhbnkpID0+IGl0ZW0ubmFtZSldXG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdClcblx0fSxcblxuXHRjaGFuZ2VDb2RlOiBmdW5jdGlvbiAoZTogYW55KSB7XG5cdFx0Y29uc29sZS5sb2coZSk7XG5cdFx0dGhpcy5zZXREYXRhISh7XG5cdFx0XHRjb2RlOiBlLmRldGFpbC52YWx1ZVxuXHRcdH0pO1xuXHRcdGNvbnNvbGUubG9nKHRoaXMuZGF0YS5jb2RlKTtcblx0fSxcblx0ZG9TZW5kTXNnOiBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIF90aGlzID0gdGhpcztcblx0XHR2YXIgX2EgPSB0aGlzLmRhdGEsIHRpbWUgPSBfYS50aW1lLCB0aW1lciA9IF9hLnRpbWVyO1xuXHRcdGlmICh0aW1lciAhPT0gMCkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdC8vIHRvZG86IOa3u+WKoOWunuaXtuebkeaOp1xuXG5cdFx0Y29uc3QgbW9iaWxlID0gdGhpcy5kYXRhLnBob25lO1xuXHRcdGNvbnN0IHR5cGUgPSAnU01TXzE2NjMyMDM0OCc7XG5cdFx0c2VuZE1zZyh7dHlwZSwgbW9iaWxlfSkudGhlbihcblx0XHRcdChyZXM6IGFueSkgPT4ge1xuXHRcdFx0XHRpZiAocmVzLmNvZGUgPT09IDEpIHtcblxuXHRcdFx0XHRcdHRpbWVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0aWYgKHRpbWUgPT09IDApIHtcblx0XHRcdFx0XHRcdFx0Y2xlYXJJbnRlcnZhbCh0aW1lcik7XG5cdFx0XHRcdFx0XHRcdF90aGlzLnNldERhdGEhKHtcblx0XHRcdFx0XHRcdFx0XHR0aW1lcjogMCxcblx0XHRcdFx0XHRcdFx0XHR0aW1lOiA2MCxcblx0XHRcdFx0XHRcdFx0XHRtc2dEYXRhOiAn6I635Y+W6aqM6K+B56CBJyxcblx0XHRcdFx0XHRcdFx0XHRhY3RpdmU6ICcnXG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR0aW1lLS07XG5cdFx0XHRcdFx0XHRfdGhpcy5zZXREYXRhISh7XG5cdFx0XHRcdFx0XHRcdG1zZ0RhdGE6IHRpbWUgKyAncycsXG5cdFx0XHRcdFx0XHRcdHRpbWVyOiB0aW1lcixcblx0XHRcdFx0XHRcdFx0YWN0aXZlOiAnYWN0aXZlJ1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fSwgMTAwMCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpO1xuXG5cblx0fSxcblxuXHRnZXRGcmVlRmlsbSgpIHtcblx0XHRjb25zdCB7dG9rZW4sXG5cdFx0XHQvLyBtdWx0aUFycmF5LG11bHRpSW5kZXgsXG5cdFx0XHRzZXJpYWxfbnVtYmVyLHBob25lLGNvZGUscGhvbmVfbW9kZWx9ID0gdGhpcy5kYXRhO1xuXG5cdFx0Ly8gbGV0IHBob25lX21vZGVsID0gbXVsdGlBcnJheVsxXVttdWx0aUluZGV4WzFdXTtcblx0XHRjb25zb2xlLmxvZyhwaG9uZV9tb2RlbCk7XG5cdFx0cmVxR2V0RnJlZUZpbG0oe3Rva2VuLHBob25lX21vZGVsLHNlcmlhbF9udW1iZXIscGhvbmUsY29kZX0pLnRoZW4oXG5cdFx0XHQocmVzOmFueSkgPT4ge1xuXHRcdFx0XHR3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgIHRpdGxlOnJlcy5tZXNzYWdlLFxuICAgICAgICAgIGljb246J25vbmUnLFxuICAgICAgICAgIGR1cmF0aW9uOjIwMDBcbiAgICAgICAgfSlcblx0XHRcdH1cblx0XHQpXG5cdH1cblxufSk7XG4iXX0=