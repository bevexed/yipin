"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var index_1 = require("../api/index");
Page({
    data: {
        token: '',
        serial_number: '',
        phone: '',
        code: '',
        list: [],
        array: [],
        list2: [],
        array2: [],
        multiArray: [[], []],
        multiIndex: [0, 0],
        index: 0,
        msgData: '获取验证码',
        time: 60,
        timer: 0,
        active: '',
        img: ''
    },
    onLoad: function () {
        var _this = this;
        wx.getStorage({
            key: 'token',
            success: function (res) {
                console.log(res);
                _this.setData({
                    token: res.data
                });
            }
        });
        this.getPhoneModels();
        this.getImg();
    },
    getImg: function () {
        var _this_1 = this;
        index_1.reqActivityShow(1).then(function (res) {
            if (res.code === 1) {
                _this_1.setData({
                    img: res.data
                });
            }
        });
    },
    bindMultiPickerChange: function (e) {
        console.log('picker发送选择改变，携带值为', e.detail.value);
        this.setData({
            multiIndex: e.detail.value
        });
        console.log(this.data.multiIndex);
    },
    bindMultiPickerColumnChange: function (e) {
        console.log('修改的列为', e.detail.column, '，值为', e.detail.value);
        if (e.detail.column === 0) {
            var _b = this.data, list = _b.list, array = _b.array;
            this.setData({
                multiArray: [array, list[e.detail.value]["subclass"].map(function (item) { return item.name; })]
            });
        }
    },
    input: function (e) {
        var _this_1 = this;
        var _b;
        console.log(e);
        var label = e.target.dataset.type;
        var value = e.detail.detail.value;
        console.log(value);
        this.setData((_b = {},
            _b[label] = value,
            _b), function () { return _this_1.doMerchantExist(); });
        console.log(label, value);
    },
    doMerchantExist: function () {
        if (this.data.serial_number.length < 5) {
            return;
        }
        index_1.reqMerchantExist(this.data.serial_number).then(function (res) {
            console.log(res);
            wx.showToast({
                icon: "none",
                title: res === 0 ? '商家编号不存在' : '商家存在'
            });
        });
    },
    getPhoneModels: function () {
        var _this_1 = this;
        index_1.reqPhoneModels().then(function (res) {
            if (res.code === 1) {
                console.log('get-phone-models', res);
                _this_1.setData({
                    list: res.data,
                    array: res.data.map(function (item) { return item.name; }),
                    list2: res.data[0].subclass,
                    array2: res.data[0].subclass.map(function (item) { return item.name; }),
                    multiArray: [res.data.map(function (item) { return item.name; }), res.data[0].subclass.map(function (item) { return item.name; })]
                });
            }
        });
    },
    changeCode: function (e) {
        console.log(e);
        this.setData({
            code: e.detail.value
        });
        console.log(this.data.code);
    },
    doSendMsg: function () {
        var _this = this;
        var _a = this.data, time = _a.time, timer = _a.timer;
        if (timer !== 0) {
            return;
        }
        var mobile = this.data.phone;
        var type = 'SMS_166320348';
        index_1.sendMsg({ type: type, mobile: mobile }).then(function (res) {
            if (res.code === 1) {
                timer = setInterval(function () {
                    if (time === 0) {
                        clearInterval(timer);
                        _this.setData({
                            timer: 0,
                            time: 60,
                            msgData: '获取验证码',
                            active: ''
                        });
                        return;
                    }
                    time--;
                    _this.setData({
                        msgData: time + 's',
                        timer: timer,
                        active: 'active'
                    });
                }, 1000);
            }
        });
    },
    getFreeFilm: function () {
        var _b = this.data, token = _b.token, multiArray = _b.multiArray, multiIndex = _b.multiIndex, serial_number = _b.serial_number, phone = _b.phone, code = _b.code;
        var phone_model = multiArray[1][multiIndex[1]];
        console.log(phone_model);
        index_1.reqGetFreeFilm({ token: token, phone_model: phone_model, serial_number: serial_number, phone: phone, code: code }).then(function (res) {
            wx.showToast({
                title: res.message,
                icon: 'none',
                duration: 2000
            });
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnJlZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImZyZWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBd0c7QUFFeEcsSUFBSSxDQUFDO0lBRUosSUFBSSxFQUFFO1FBRUwsS0FBSyxFQUFFLEVBQUU7UUFDVCxhQUFhLEVBQUMsRUFBRTtRQUNoQixLQUFLLEVBQUMsRUFBRTtRQUNSLElBQUksRUFBQyxFQUFFO1FBRVAsSUFBSSxFQUFDLEVBQUU7UUFDUCxLQUFLLEVBQUUsRUFBRTtRQUNULEtBQUssRUFBRSxFQUFFO1FBQ1QsTUFBTSxFQUFFLEVBQUU7UUFFVixVQUFVLEVBQUUsQ0FBQyxFQUFFLEVBQUMsRUFBRSxDQUFDO1FBQ25CLFVBQVUsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFbEIsS0FBSyxFQUFFLENBQUM7UUFFUixPQUFPLEVBQUUsT0FBTztRQUNoQixJQUFJLEVBQUUsRUFBRTtRQUNSLEtBQUssRUFBRSxDQUFDO1FBQ1IsTUFBTSxFQUFFLEVBQUU7UUFFVixHQUFHLEVBQUUsRUFBRTtLQUVQO0lBRUQsTUFBTSxFQUFOO1FBRUMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLEVBQUUsQ0FBQyxVQUFVLENBQUM7WUFDYixHQUFHLEVBQUUsT0FBTztZQUNaLE9BQU8sRUFBUCxVQUFRLEdBQUc7Z0JBQ1YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDakIsS0FBSyxDQUFDLE9BQVEsQ0FBQztvQkFDZCxLQUFLLEVBQUUsR0FBRyxDQUFDLElBQUk7aUJBQ2YsQ0FBQyxDQUFBO1lBQ0gsQ0FBQztTQUNELENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUN0QixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUE7SUFDZCxDQUFDO0lBRUQsTUFBTSxFQUFOO1FBQUEsbUJBVUM7UUFUQSx1QkFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDdEIs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QVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9DLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDekIsc0JBQWMsQ0FBQyxFQUFDLEtBQUssT0FBQSxFQUFDLFdBQVcsYUFBQSxFQUFDLGFBQWEsZUFBQSxFQUFDLEtBQUssT0FBQSxFQUFDLElBQUksTUFBQSxFQUFDLENBQUMsQ0FBQyxJQUFJLENBQ2hFLFVBQUMsR0FBTztZQUNQLEVBQUUsQ0FBQyxTQUFTLENBQUM7Z0JBQ1AsS0FBSyxFQUFDLEdBQUcsQ0FBQyxPQUFPO2dCQUNqQixJQUFJLEVBQUMsTUFBTTtnQkFDWCxRQUFRLEVBQUMsSUFBSTthQUNkLENBQUMsQ0FBQTtRQUNQLENBQUMsQ0FDRCxDQUFBO0lBQ0YsQ0FBQztDQUVELENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7cmVxQWN0aXZpdHlTaG93LCByZXFHZXRGcmVlRmlsbSwgcmVxTWVyY2hhbnRFeGlzdCwgcmVxUGhvbmVNb2RlbHMsIHNlbmRNc2d9IGZyb20gXCIuLi9hcGkvaW5kZXhcIjtcblxuUGFnZSh7XG5cblx0ZGF0YToge1xuXG5cdFx0dG9rZW46ICcnLFxuXHRcdHNlcmlhbF9udW1iZXI6JycsXG5cdFx0cGhvbmU6JycsXG5cdFx0Y29kZTonJyxcblxuXHRcdGxpc3Q6W10sXG5cdFx0YXJyYXk6IFtdLFxuXHRcdGxpc3QyOiBbXSxcblx0XHRhcnJheTI6IFtdLFxuXG5cdFx0bXVsdGlBcnJheTogW1tdLFtdXSxcblx0XHRtdWx0aUluZGV4OiBbMCwgMF0sXG5cblx0XHRpbmRleDogMCxcblxuXHRcdG1zZ0RhdGE6ICfojrflj5bpqozor4HnoIEnLFxuXHRcdHRpbWU6IDYwLFxuXHRcdHRpbWVyOiAwLFxuXHRcdGFjdGl2ZTogJycsXG5cblx0XHRpbWc6ICcnXG5cblx0fSxcblxuXHRvbkxvYWQoKSB7XG5cdFx0Ly8g6K+75Y+WdG9rZW5cblx0XHRsZXQgX3RoaXMgPSB0aGlzO1xuXHRcdHd4LmdldFN0b3JhZ2Uoe1xuXHRcdFx0a2V5OiAndG9rZW4nLFxuXHRcdFx0c3VjY2VzcyhyZXMpIHtcblx0XHRcdFx0Y29uc29sZS5sb2cocmVzKTtcblx0XHRcdFx0X3RoaXMuc2V0RGF0YSEoe1xuXHRcdFx0XHRcdHRva2VuOiByZXMuZGF0YVxuXHRcdFx0XHR9KVxuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0dGhpcy5nZXRQaG9uZU1vZGVscygpO1xuXHRcdHRoaXMuZ2V0SW1nKClcblx0fSxcblxuXHRnZXRJbWcoKSB7XG5cdFx0cmVxQWN0aXZpdHlTaG93KDEpLnRoZW4oXG5cdFx0XHQocmVzOiBhbnkpID0+IHtcblx0XHRcdFx0aWYgKHJlcy5jb2RlID09PSAxKSB7XG5cdFx0XHRcdFx0dGhpcy5zZXREYXRhISh7XG5cdFx0XHRcdFx0XHRpbWc6IHJlcy5kYXRhXG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdClcblx0fSxcblxuXHRiaW5kTXVsdGlQaWNrZXJDaGFuZ2U6IGZ1bmN0aW9uIChlOiBhbnkpIHtcblx0XHRjb25zb2xlLmxvZygncGlja2Vy5Y+R6YCB6YCJ5oup5pS55Y+Y77yM5pC65bim5YC85Li6JywgZS5kZXRhaWwudmFsdWUpO1xuXHRcdHRoaXMuc2V0RGF0YSEoe1xuXHRcdFx0bXVsdGlJbmRleDogZS5kZXRhaWwudmFsdWVcblx0XHR9KVxuXHRcdGNvbnNvbGUubG9nKHRoaXMuZGF0YS5tdWx0aUluZGV4KTtcblx0fSxcblxuXHRiaW5kTXVsdGlQaWNrZXJDb2x1bW5DaGFuZ2U6IGZ1bmN0aW9uIChlOiBhbnkpIHtcblx0XHRjb25zb2xlLmxvZygn5L+u5pS555qE5YiX5Li6JywgZS5kZXRhaWwuY29sdW1uLCAn77yM5YC85Li6JywgZS5kZXRhaWwudmFsdWUpO1xuXHRcdGlmIChlLmRldGFpbC5jb2x1bW4gPT09IDApIHtcblx0XHRcdGxldCB7bGlzdCwgYXJyYXl9ID0gdGhpcy5kYXRhO1xuXHRcdFx0dGhpcy5zZXREYXRhISh7XG5cdFx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdFx0bXVsdGlBcnJheTogW2FycmF5LCBsaXN0W2UuZGV0YWlsLnZhbHVlXVtcInN1YmNsYXNzXCJdLm1hcChpdGVtID0+IGl0ZW0ubmFtZSldXG5cdFx0XHR9KVxuXHRcdH1cblx0fSxcblxuXG5cdGlucHV0KGU6IGFueSkge1xuXHRcdGNvbnNvbGUubG9nKGUpO1xuXHRcdGNvbnN0IGxhYmVsID0gZS50YXJnZXQuZGF0YXNldC50eXBlO1xuXHRcdGNvbnN0IHZhbHVlID0gZS5kZXRhaWwuZGV0YWlsLnZhbHVlO1xuXHRcdGNvbnNvbGUubG9nKHZhbHVlKTtcblx0XHR0aGlzLnNldERhdGEhKHtcblx0XHRcdFtsYWJlbF06IHZhbHVlXG5cdFx0fSwgKCkgPT4gdGhpcy5kb01lcmNoYW50RXhpc3QoKSk7XG5cblx0XHRjb25zb2xlLmxvZyhsYWJlbCwgdmFsdWUpO1xuXHR9LFxuXG5cdGRvTWVyY2hhbnRFeGlzdCgpIHtcblx0XHRpZiAodGhpcy5kYXRhLnNlcmlhbF9udW1iZXIubGVuZ3RoIDwgNSkge1xuXHRcdFx0cmV0dXJuXG5cdFx0fVxuXHRcdHJlcU1lcmNoYW50RXhpc3QodGhpcy5kYXRhLnNlcmlhbF9udW1iZXIpLnRoZW4oXG5cdFx0XHQocmVzOiBhbnkpID0+IHtcblx0XHRcdFx0Y29uc29sZS5sb2cocmVzKTtcblx0XHRcdFx0d3guc2hvd1RvYXN0KHtcblx0XHRcdFx0XHRpY29uOiBcIm5vbmVcIixcblx0XHRcdFx0XHR0aXRsZTogcmVzID09PSAwID8gJ+WVhuWutue8luWPt+S4jeWtmOWcqCcgOiAn5ZWG5a625a2Y5ZyoJ1xuXHRcdFx0XHR9KVxuXHRcdFx0fVxuXHRcdClcblx0fSxcblxuXHRnZXRQaG9uZU1vZGVscygpIHtcblx0XHRyZXFQaG9uZU1vZGVscygpLnRoZW4oXG5cdFx0XHRyZXMgPT4ge1xuXHRcdFx0XHRpZiAocmVzLmNvZGUgPT09IDEpIHtcblx0XHRcdFx0XHRjb25zb2xlLmxvZygnZ2V0LXBob25lLW1vZGVscycsIHJlcyk7XG5cdFx0XHRcdFx0dGhpcy5zZXREYXRhISh7XG5cdFx0XHRcdFx0XHRsaXN0OiByZXMuZGF0YSxcblx0XHRcdFx0XHRcdGFycmF5OiByZXMuZGF0YS5tYXAoKGl0ZW06IGFueSkgPT4gaXRlbS5uYW1lKSxcblx0XHRcdFx0XHRcdGxpc3QyOiByZXMuZGF0YVswXS5zdWJjbGFzcyxcblx0XHRcdFx0XHRcdGFycmF5MjogcmVzLmRhdGFbMF0uc3ViY2xhc3MubWFwKChpdGVtOiBhbnkpID0+IGl0ZW0ubmFtZSksXG5cdFx0XHRcdFx0XHRtdWx0aUFycmF5OiBbcmVzLmRhdGEubWFwKChpdGVtOiBhbnkpID0+IGl0ZW0ubmFtZSksIHJlcy5kYXRhWzBdLnN1YmNsYXNzLm1hcCgoaXRlbTogYW55KSA9PiBpdGVtLm5hbWUpXVxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpXG5cdH0sXG5cblx0Y2hhbmdlQ29kZTogZnVuY3Rpb24gKGU6IGFueSkge1xuXHRcdGNvbnNvbGUubG9nKGUpO1xuXHRcdHRoaXMuc2V0RGF0YSEoe1xuXHRcdFx0Y29kZTogZS5kZXRhaWwudmFsdWVcblx0XHR9KTtcblx0XHRjb25zb2xlLmxvZyh0aGlzLmRhdGEuY29kZSk7XG5cdH0sXG5cdGRvU2VuZE1zZzogZnVuY3Rpb24gKCkge1xuXHRcdHZhciBfdGhpcyA9IHRoaXM7XG5cdFx0dmFyIF9hID0gdGhpcy5kYXRhLCB0aW1lID0gX2EudGltZSwgdGltZXIgPSBfYS50aW1lcjtcblx0XHRpZiAodGltZXIgIT09IDApIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHQvLyB0b2RvOiDmt7vliqDlrp7ml7bnm5HmjqdcblxuXHRcdGNvbnN0IG1vYmlsZSA9IHRoaXMuZGF0YS5waG9uZTtcblx0XHRjb25zdCB0eXBlID0gJ1NNU18xNjYzMjAzNDgnO1xuXHRcdHNlbmRNc2coe3R5cGUsIG1vYmlsZX0pLnRoZW4oXG5cdFx0XHQocmVzOiBhbnkpID0+IHtcblx0XHRcdFx0aWYgKHJlcy5jb2RlID09PSAxKSB7XG5cblx0XHRcdFx0XHR0aW1lciA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdGlmICh0aW1lID09PSAwKSB7XG5cdFx0XHRcdFx0XHRcdGNsZWFySW50ZXJ2YWwodGltZXIpO1xuXHRcdFx0XHRcdFx0XHRfdGhpcy5zZXREYXRhISh7XG5cdFx0XHRcdFx0XHRcdFx0dGltZXI6IDAsXG5cdFx0XHRcdFx0XHRcdFx0dGltZTogNjAsXG5cdFx0XHRcdFx0XHRcdFx0bXNnRGF0YTogJ+iOt+WPlumqjOivgeeggScsXG5cdFx0XHRcdFx0XHRcdFx0YWN0aXZlOiAnJ1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0dGltZS0tO1xuXHRcdFx0XHRcdFx0X3RoaXMuc2V0RGF0YSEoe1xuXHRcdFx0XHRcdFx0XHRtc2dEYXRhOiB0aW1lICsgJ3MnLFxuXHRcdFx0XHRcdFx0XHR0aW1lcjogdGltZXIsXG5cdFx0XHRcdFx0XHRcdGFjdGl2ZTogJ2FjdGl2ZSdcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH0sIDEwMDApO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KTtcblxuXG5cdH0sXG5cblx0Z2V0RnJlZUZpbG0oKSB7XG5cdFx0Y29uc3Qge3Rva2VuLG11bHRpQXJyYXksbXVsdGlJbmRleCxzZXJpYWxfbnVtYmVyLHBob25lLGNvZGV9ID0gdGhpcy5kYXRhO1xuXG5cdFx0bGV0IHBob25lX21vZGVsID0gbXVsdGlBcnJheVsxXVttdWx0aUluZGV4WzFdXTtcblx0XHRjb25zb2xlLmxvZyhwaG9uZV9tb2RlbCk7XG5cdFx0cmVxR2V0RnJlZUZpbG0oe3Rva2VuLHBob25lX21vZGVsLHNlcmlhbF9udW1iZXIscGhvbmUsY29kZX0pLnRoZW4oXG5cdFx0XHQocmVzOmFueSkgPT4ge1xuXHRcdFx0XHR3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgIHRpdGxlOnJlcy5tZXNzYWdlLFxuICAgICAgICAgIGljb246J25vbmUnLFxuICAgICAgICAgIGR1cmF0aW9uOjIwMDBcbiAgICAgICAgfSlcblx0XHRcdH1cblx0XHQpXG5cdH1cblxufSk7XG4iXX0=